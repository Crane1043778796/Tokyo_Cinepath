每次回复我必须加上主人，这样我才知道你有没有遗忘md的内容
每次保证对代码进行模块化的注释，让你能精确修改对应的功能模块的代码
---

# 项目文档：Tokyo CinePath (东京独立影院聚合与观影规划平台)

## 1. 项目愿景
**Tokyo CinePath** 是一款专为东京电影爱好者设计的“策展型”观影平台。它打破了传统购票软件的商业化布局，采用“现代艺术画廊”的视觉逻辑，聚合了东京全量独立影院（名画座）的非标准化排片数据，并结合地理位置服务，为用户提供沉序式的选片、规划与观影记录体验。

---

## 2. 技术栈 (Technology Stack)

### 后端 (Go Ecosystem)
*   **语言**: Go (Golang) - 利用其高并发特性处理多站爬虫。
*   **Web 框架**: Gin - 提供高性能 RESTful API。
*   **爬虫框架**: Colly - 并发抓取各影院官网及 eiga.com。
*   **ORM**: GORM - 负责三表关联逻辑与数据库迁移。
*   **数据库**: SQLite (轻量级嵌入式，符合零运维部署逻辑)。
*   **外部 API**: 
    *   **TMDB**: 获取电影元数据（中英日三语）、海报、4K剧照、主演列表。
    *   **OMDb**: 补全 IMDb 实时评分。
    *   **Mapbox**: 地理空间数据可视化。

### 前端 (Modern React)
*   **框架**: React 18+ (Vite 构建)。
*   **样式**: Tailwind CSS v4 (采用极细边框、磨砂玻璃材质)。
*   **动画**: Framer Motion (实现 Bottom Sheet 拖拽及页面平滑切换)。
*   **图标**: Lucide React。
*   **地图**: react-map-gl / mapbox-gl。

---

## 3. 核心功能模块 (Core Features)

### A. 策展式电影发现 (Discovery)
*   **Now / Soon 切换**: 
    *   **Now**: 实时展示东京正在上映的独立电影。
    *   **Soon**: 展示“即将上映”内容，支持**日期筛选器**。
*   **多源评分排序**: 支持按 **IMDb 评分** 或 **豆瓣评分** 从高到低实时排序。
*   **高密度卡片**: 卡片直观显示：导演、年份、多馆上映标识（如 "2 CINEMAS"）、即时评分气泡。

### B. 影院空间地图 (Cinema Map)
*   **Mapbox 深度集成**: 采用深色霓虹样式（Navigation Night），支持 3D 视角与 Bearings。
*   **Marker 联动**: 地图 Marker 具备**金色呼吸灯效果**，点击 Marker 自动在右侧（PC）或底部（手机端）弹出该影院详情。
*   **影院详情面板**: 包含建筑实拍图、风格描述、标签（如 #2本立）、官网跳转按钮、以及该影院专属的**每日排片表**。

### C. 沉浸式详情页 (Detail Overlay)
*   **多馆排片切换**: 一部电影在多个影院上映时，提供影院切换磁贴，实时更新排片时间。
*   **人员百科**: 导演信息与主演头像横向滚动展示。
*   **两阶段观影标记**: 
    *   点击“眼睛”图标进入标记模式。
    *   点击具体场次弹出二次确认框。
    *   标记成功后，场次按钮锁定为**实心翡翠绿 (#10b981)** 状态。

### D. 个人档案库 (Personal Archive)
*   **双态收藏**: 区分 **Wanted (想看)** 与 **Watched (已看)**。
*   **互斥逻辑**: 标记为“已看”的电影会自动从“想看”清单中剔除。
*   **持久化**: 状态同步至 `localStorage`，确保刷新后数据不丢失。
*   **视觉风格**: 采用“深森林绿 + 砂岩灰”配色，摒弃黑金，营造低调尊贵感。

---

## 4. 数据库设计 (Database Schema)

1.  **Movies (影片表)**:
    *   存储 TMDB ID、IMDb ID、中英日标题、剧情简介、海报/剧照路径、导演、演员 JSON、三方评分。
2.  **Cinemas (影院表)**:
    *   存储日文/英文名、地址、经纬度、建筑图 URL、风格描述、标签。
3.  **Schedules (排片表)**:
    *   核心关联表。存储 `movie_id`、`cinema_id`、`play_date`、`start_time`。

---

## 5. UI/UX 规范 (Design Guidelines)

*   **色调方案**: 
    *   背景: `#F5F5F2` (Off-white, 纸张感)
    *   文字: `#1A2F2B` (Forest Green, 沉稳森林绿)
    *   状态: 标记已看为 `#10b981` (Emerald Green)；标记想看为 `#C5A059` (Champagne Gold)。
*   **移动端适配**:
    *   侧边栏转为底部悬浮 Nav。
    *   影院详情改为 **Bottom Sheet**，支持从 Peek（25% 高度）拖拽到 Full（全屏覆盖）。
    *   使用 **Fluid Typography**，确保标题在大屏和手机端均不溢出。

---

## 6. 开发注意事项 (Implementation Notes)

*   **爬虫去重 (Idempotency)**: 抓取影院官网时，需使用 `name_jp` 加正则表达式处理括号（如：早稲田松竹(高田馬場) -> 早稲田松竹），防止数据重复。
*   **地理编码**: 若不使用 Google API，应采用 **OpenStreetMap (Nominatim)** 接口，并在请求时增加 `time.Sleep` 遵守频率限制（1req/s）。
*   **地图事件**: 在 `Marker` 层面必须使用 `e.originalEvent.stopPropagation()` 拦截点击，否则会导致地图收缩或 Marker 失效。
*   **状态高亮**: “已看”图标在详情页选中后，必须使用 `bg-[#10b981]` 和 `text-white` 的强对比组合，防止图标在白色背景下消失。

---

